# Vim

Vi 是所有 Linux 系统都自带的命令行界面文本编辑器, 而 Vim (**V**i **im**proved) 则是它的增强版.

## 基本功能

本节列举 Vim 的基本功能, 所有内容同时适用于 Vi 和 Vim.

### 三种模式

Vim 有三种模式:

| 类型 | 功能 |
| ---- | ---- |
| COMMAND 模式 (默认) | 移动光标, 删除或复制/粘贴字符或整行字符串. |
| COMMAND-LINE 模式 | 搜索/替换字符串, 读取/保存文件. |
| INSERT 模式 | 移动光标, 输入/删除字符. |

这几种模式通过以下方式来切换:

| From | To | By |
| ---- | -- | -- |
| COMMAND | COMMAND-LINE | 输入`:/?`中的任意一个字符 |
| COMMAND | INSERT       | 输入`ioar`或`IOAR`中的任意一个字符 |
| INSERT | COMMAND | 按下`[Esc]`键 |
| COMMAND-LINE | COMMAND | 按下`[Esc]`键 |

### 典型步骤

#### 打开

在 Shell 中输入

```shell
vim name
```

以新建或打开名为 name 的文件. 也可以不带文件名, 直接进入 Vim.

#### 编辑

文件打开后, 默认进入 COMMAND 模式. 按下`ioar`或`IOAR`中的任意一个, 进入 INSERT 模式. 此时, 可以像在其他文本编辑器中一样, 对文件进行编辑. 

#### 保存

编辑过程中或完成编辑后, 如果需要保存当前修改, 则按下`[Esc]`键回到 COMMAND 模式. 然后再按下`:`进入 COMMAND-LINE 模式, 在`:`后输入`w + [Enter]`

- 若有写入权限, 则修改内容将被写入 (**w**rite) 文件.
- 若没有写入权限, 则报错.

#### 退出

完成编辑后, 按下`[Esc]`键回到 COMMAND 模式. 然后再按下`:`进入 COMMAND-LINE 模式, 在`:`后输入`q + [Enter]`

- 若文件内容没有被修改, 则直接退出 (**q**uit).
- 若文件内容被修改过且没有被写入, 则报错.

## 常用命令

### COMMAND 模式

#### 移动光标

| 命令 | 功能 |
| ---- | ---- |
| `h`或`8h` | 向左移动 1 或 8 个字符 |
| `j`或`8j` | 向下移动 1 或 8 个字符 |
| `k`或`8k` | 向上移动 1 或 8 个字符 |
| `l`或`8l` | 向右移动 1 或 8 个字符 |
| `8 + [Space]` | 向右移动 8 个字符 |
| `8 + [Enter]` | 向下移动 8 行 |
| `[Ctrl] + f` | 向下移动一页, 相当于`[PageDown]` |
| `[Ctrl] + b` | 向上移动一页, 相当于`[PageUp]` |
| `0` | 跳到光标所在行首, 相当于`[Home]` |
| `$` | 跳到光标所在行尾, 相当于`[End]` |
| `H` | 跳到当前页面的第一行 |
| `L` | 跳到当前页面的最后一行 |
| `G` | 跳到当前文件的最后一行 |
| `8G` | 跳到当前文件的第 8 行 |
| `gg` | 跳到当前文件的第一行, 相当于`1G` |

#### 搜索

| 命令 | 功能 |
| ---- | ---- |
| `/word` | 向后查找`word` |
| `?word` | 向前查找`word` |
| `n` | 重复前一次查找 |
| `N` |  反向进行前一次查找 |

#### 替换

| 命令 | 功能 |
| ---- | ---- |
| `:1,8s/old/new/g` | 在`[1,8]`行之间, 将`old`替换为`new` |
| `:1,$s/old/new/g` | 在全文中, 将`old`替换为`new` |
| `:1,$s/old/new/gc` | 同上, 替换前要求确认 |

#### 删除/复制

下表中`c`表示光标所在字符.

| 命令 | 功能 |
| ---- | ---- |
| `x` | 删除`c`, 相当于`[Del]` |
| `8x` | 删除`[c, c+8)`, 相当于连按 8 次 `[Del]` |
| `X` | 删除`c-1`, 相当于`[Backspace]` |
| `8X` | 删除`[c-8, c)`, 相当于连按 8 次 `[Backspace]` |
| `d0` | 删除`[0, c)`, `0`表示光标所在行第一个字符 |
| `d$` | 删除`[c, last)`, `last`表示换行符 |

下表中`r`表示表示光标所在行. 

| 命令 | 功能 |
| ---- | ---- |
| `dd` | 删除`r` |
| `8dd` | 删除`[r, r+8)` |
| `dG` | 删除`[r, last]` |
| `d8G` | 删除`[min(r,8), max(r,8)]` |

以上各删除命令中的`d`替换为`y`则为对应的复制命令.

#### 粘贴

假设已经复制了 8 个字符或行, `c`表示当前光标所在字符或行.

| 命令 | 功能 |
| ---- | ---- |
| `p` | 粘贴在`[c+1, c+8]`, 原`c+1`顺延到`c+9` |
| `P` | 粘贴在`[c, c+8)`, 原`c`顺延到`c+8` |
| `J` | 将光标所在行尾的换行符替换为空格 |

#### 撤销/重做

| 命令 | 功能 |
| ---- | ---- |
| `u` | 撤销前一个动作 |
| `[Ctrl] + r` | 重做被撤销的动作 |
| `.` | 重做前一个动作 |

### COMMAND-LINE 模式

| 命令 | 功能 |
| ---- | ---- |
| `:w` | **w**rite |
| `:w!` | 强行 **w**rite |
| `:q` | **q**uit |
| `:q!` | 强行 **q**uit |
| `:wq` | 先 **w**rite 再 **q**uit |
| `ZZ` | 若没有修改过, 则`:q`, 否则`:wq` |
| `:w name` | 将当前数据写入名为`name`的文件, 类似于"另存为" |
| `:r name` | 从名为`name`的文件读取数据, 插入到光标所在行的下一行 |
| `:1,8 w name` | 将`[1,8]`行的内容写入名为`name`的文件 |
| `:! cmd` | 暂时离开 Vim, 执行名为`cmd`的 Shell 命令 |

### INSERT 模式

从 COMMAND 模式进入 INSERT 模式有以下 4 种方式:

| 命令 | 功能 |
| ---- | ---- |
| `i` | 从光标所在字符前开始插入 |
| `I` | 从光标所在行的第一个非空白字符前开始插入 |
| `a` | 从光标所在字符后开始插入 |
| `A` | 从光标所在行的最后一个字符后开始插入 |
| `o` | 在光标所在行后面插入新的一行 |
| `O` | 在光标所在行前面插入新的一行 |
| `r` | 进入 *r*eplace 模式, 将光标所在字符替换为随后输入的一个字符, 然后回到 COMMAND 模式 |
| `R` | 进入 *R*eplace 模式 (特殊的 INSERT 模式), 将光标所在字符逐个替换为随后输入的字符, 直到按下`[Esc]`回到 COMMAND 模式 |

- 通过`iIaAoO`进入 INSERT 模式后, 左下角会出现`-- INSERT --`.
- 通过`R`进入 *R*eplace  模式后, 左下角会出现`-- REPLACE --`.

## 高级功能

### 区块选择

如果有以下文件:

```
192.168.1.1  host1.school.edu
192.168.1.2  host2.school.edu
192.168.1.3  host3.school.edu
```

现在要将`host1`, `host2`, `host3`复制并粘贴到各行最后, 即改为以下形式:

```
192.168.1.1  host1.school.edu  host1
192.168.1.2  host2.school.edu  host2
192.168.1.3  host3.school.edu  host3
```

这种需求在 Vim 中可以很容易地实现. 在 COMMAND 模式下:

| 命令 | 功能 |
| ---- | ---- |
| `v`        | 选择字符, 光标扫过的字符反色     |
| `V`        | 选择整行, 光标扫过的整行反色     |
| `[Ctrl] + v` | 选择区块, 光标扫过的矩形区块反色 |
| `y`        | cop**y** 选中的反色区域          |
| `d`        | **d**elete 选中的反色区域        |
| `p`        | **p**aste 选中的反色区域         |

### 多文件编辑

### 多窗口编辑

### 自动补全

## 修改配置

### 在 COMMAND-LINE 模式中修改

如果已经进入 Vim, 并且需要临时修改 Vim 配置, 可以利用`:set`命令. 这种方式只在当前 Vim 进程中有效. 例如:

| 命令 | 功能 |
| ---- | ---- |
| `:set nu` | 显示行号 |
| `:set nonu` | 不显示行号 |

### 在配置文件中修改

