---
title: Cache Lab
---

# Part A: Writing a Cache Simulator

# Part B: Optimizing Matrix Transpose

## $32\times32$

```c
void trans_32x32(int M, int N, int A[M][N], int B[M][N]);
/*
  &A[0][0] == 0x10c0a0
           == 0001 0000 1100 0000 1010 0000
              \______tag______/\_s__/\_b__/
  &A[i][j] == 0x10c0a0 + i * 32 * 4 + j * 4
           == 0x10c0a0 + i * 0x80 + j * 0x4
  &B[0][0] == 0x14c0a0
           == 0001 0100 1100 0000 1010 0000
              \______tag______/\_s__/\_b__/
 */
```

|   Set ID   | `0 <= col < 8` | `8 <= col < 16` | `16 <= col < 24` | `24 <= col < 32` |
| :--------: | :------------: | :-------------: | :--------------: | :--------------: |
| `row == 0` |      `05`      |      `06`       |       `07`       |       `08`       |
| `row == 1` |      `09`      |      `10`       |       `11`       |       `12`       |
| `row == 2` |      `13`      |      `14`       |       `15`       |       `16`       |
| `row == 3` |      `17`      |      `18`       |       `19`       |       `20`       |
| `row == 4` |      `21`      |      `22`       |       `23`       |       `24`       |
| `row == 5` |      `25`      |      `26`       |       `27`       |       `28`       |
| `row == 6` |      `29`      |      `30`       |       `31`       |       `00`       |
| `row == 7` |      `01`      |      `02`       |       `03`       |       `04`       |
| `row == 8` |      `05`      |      `06`       |       `07`       |       `08`       |
|   `...`    |     `...`      |      `...`      |      `...`       |      `...`       |

## $64\times64$

```c
void trans_64x64(int M, int N, int A[M][N], int B[M][N]);
/*
  &A[0][0] == 0x10d0a0
           == 0001 0000 1101 0000 1010 0000
              \______tag______/\_s__/\_b__/
  &A[i][j] == 0x10d0a0 + i * 64 * 4 + j * 4
           == 0x10d0a0 + i * 0x100 + j * 0x4
  &B[0][0] == 0x14d0a0
           == 0001 0100 1101 0000 1010 0000
              \______tag______/\_s__/\_b__/
 */
```

| `row` \ set ID \ `col` | `[0, 8)` | `[8, 16)` | `[16, 24)` | `[24, 32)` | `[32, 40)` | `[40, 48)` | `[48, 56)` | `[56, 64)` |
| :--------------------: | :------: | :-------: | :--------: | :--------: | :--------: | :--------: | :--------: | :--------: |
|          `0`           |   `05`   |   `06`    |    `07`    |    `08`    |    `09`    |    `10`    |    `11`    |    `12`    |
|          `1`           |   `13`   |   `14`    |    `15`    |    `16`    |    `17`    |    `18`    |    `19`    |    `20`    |
|          `2`           |   `21`   |   `22`    |    `23`    |    `24`    |    `25`    |    `26`    |    `27`    |    `28`    |
|          `3`           |   `29`   |   `30`    |    `31`    |    `00`    |    `01`    |    `02`    |    `03`    |    `04`    |
|          `4`           |   `05`   |   `06`    |    `07`    |    `08`    |    `09`    |    `10`    |    `11`    |    `12`    |
|          `5`           |   `13`   |   `14`    |    `15`    |    `16`    |    `17`    |    `18`    |    `19`    |    `20`    |
|          `6`           |   `21`   |   `22`    |    `23`    |    `24`    |    `25`    |    `26`    |    `27`    |    `28`    |
|          `7`           |   `29`   |   `30`    |    `31`    |    `00`    |    `01`    |    `02`    |    `03`    |    `04`    |
|          `8`           |   `05`   |   `06`    |    `07`    |    `08`    |    `09`    |    `10`    |    `11`    |    `12`    |
|         `...`          |  `...`   |   `...`   |   `...`    |   `...`    |   `...`    |   `...`    |   `...`    |   `...`    |

## $61\times67$

```c
void trans_61x67(int M, int N, int A[M][N], int B[M][N]);
/*
  &A[0][0] == 0x10d0c0
           == 0001 0000 1101 0000 1100 0000
              \______tag______/\_s__/\_b__/
  &A[i][j] == 0x10d0c0 + i * 32 * 4 + j * 4
           == 0x10d0c0 + i * 0x100 + j * 0x4
  &B[0][0] == 0x14d0c0
           == 0001 0100 1101 0000 1100 0000
              \______tag______/\_s__/\_b__/
 */
```

